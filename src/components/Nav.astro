---
import { getCollection } from "astro:content"

const sections = await getCollection("links");
---

<nav 
  class=" -translate-y-1/2 gap-5 z-50 flex md:flex-col max-md:place-self-center md:left-5 md:top-1/2 top-5 fixed items-center justify-center py-1"
  x-data="{ activeSection: 'Profile' }"
  x-init="
    requestAnimationFrame(() => {
      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            activeSection = entry.target.id;
          }
        });
      }, {
        threshold: 0.25,
        rootMargin: '0px 0px -25% 0px'
      });

      document.querySelectorAll('section[id]').forEach(section => {
        observer.observe(section);
      });
    }, 300);
  "
>
  <div class="bg-gray-400 z-0 w-full px-2.5 absolute h-full rounded-2xl"></div>

  {sections.sort((a, b) => a.data.id - b.data.id).map((entry) => { 
    const section = entry.data
    return(
      <a 
        href={`#${section.link}`} 
        class="size-4 bg-black cursor-pointer, transition-all duration-75 ease rounded-full relative group"
        :class="{ 'animate-pulse scale-150 ring-2 ring-blue-200 block': activeSection === $el.dataset.id }"
        @click="activeSection = $el.dataset.id"
        data-id={section.link}
        data-name={section.name}
      >
        <span 
          class="absolute left-5 top-1/2 -translate-y-1/2 whitespace-nowrap bg-black/70 text-white px-2 py-0.5 rounded text-xs max-md:hidden " 
        >{section.name}</span>
      </a>
  )})}
</nav>
